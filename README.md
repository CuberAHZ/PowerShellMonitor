# PowerShell Tray Manager

> 一个基于 PySide6 的系统托盘应用程序，用于监控和管理 PowerShell 进程或任何其他可执行程序。

## 功能特点

- 🖥️ **系统托盘集成** - 在系统托盘中运行，不占用任务栏空间
- ⚡ **进程管理** - 启动、停止和监控 PowerShell 或其他可执行程序
- 📊 **实时日志** - 查看进程的实时输出日志
- ⏰ **时间戳选项** - 可选择是否在日志中添加时间戳
- 🔧 **配置文件** - 通过配置文件自定义要运行的命令
- 🔄 **重新加载配置** - 无需重启程序即可应用配置更改
- 🚀 **开机自启动** - 支持设置开机自动启动
- 🔒 **单实例运行** - 防止程序重复打开

## 安装和运行

### 前提条件

- Python 3.7 或更高版本
- PySide6 库
- windows8.1 及以上

### 安装依赖

```bash
pip install PySide6
```

### 运行程序

```bash
python PowerShellMonitor.py
```

### 打包为可执行文件

你可以直接下载release

或者使用 PyInstaller 将程序打包为独立的可执行文件：

```bash
pip install pyinstaller
pyinstaller -i ps.ico --onefile --windowed --name PowerShellMonitor PowerShellMonitor.py
```

打包后的可执行文件将位于 `dist` 目录中。

## 配置说明

程序会在首次运行时自动创建配置文件 `config.ini`，包含以下选项：

### PS_COMMAND
要执行的 PowerShell 命令或可执行文件路径。

默认值：
```ini
PS_COMMAND = while ($true) {
    Write-Output "当前时间: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"
    Write-Output "进程ID: $PID"
    Write-Output "运行状态: 正常"
    Write-Output "---"
    Start-Sleep -Seconds 5
}
```

### TIME
是否在日志中添加时间戳。

默认值：
```ini
TIME = False
```

## 使用说明

### 系统托盘菜单

右键点击系统托盘图标可访问以下功能：

- **查看状态** - 打开日志窗口，显示进程输出
- **停止/运行** - 切换进程的运行状态
- **开机自启动** - 启用或禁用开机自动启动
- **重新加载配置** - 重新读取配置文件并应用更改
- **退出** - 停止进程并退出程序

### 日志查看

点击"查看状态"打开日志窗口，您可以：
- 查看进程的实时输出
- 清空日志内容
- 关闭窗口后再次打开时会重新加载最新日志

### 自定义命令

要运行自定义命令或程序，编辑 `config.ini` 文件中的 `PS_COMMAND` 选项：

1. 对于 PowerShell 命令：
   ```ini
   PS_COMMAND = your-powershell-command-here
   ```

2. 对于可执行文件：
   ```ini
   PS_COMMAND = C:\path\to\your\program.exe --arguments
   ```

编辑配置文件后，点击"重新加载配置"菜单项应用更改。

## 故障排除

### 权限问题

如果程序无法创建或写入配置文件/日志文件，请：
1. 以管理员身份运行程序，或
2. 将程序移动到有写入权限的目录

### 进程无法启动

如果指定的命令无法启动，请检查：
1. 命令语法是否正确
2. 路径是否存在
3. 是否有执行权限

### 开机自启动不工作

如果开机自启动功能不工作，请检查：
1. 程序是否位于系统启动时有权限访问的位置
2. 防病毒软件是否阻止了自启动

## 技术支持

如果您遇到问题或有建议，请：
1. 检查日志文件中的错误信息
2. 确保所有依赖项已正确安装
3. 验证配置文件格式是否正确

## 许可证

本项目使用 MIT 许可证。有关详细信息，请参阅 LICENSE 文件。

## 更新日志

### v0.1.1
- 优化项目结构

### v0.1.0
- 初始版本发布
- 基本进程监控功能
- 系统托盘集成
- 配置文件支持
- 开机自启动功能

---

**注意**：本程序仅供学习和参考使用。在使用自定义命令时，请确保您了解命令的功能和潜在风险。